{"title":"数字图像处理期末","date":"2021-06-09T01:47:16.000Z","date_formatted":{"ll":"Jun 9, 2021","L":"06/09/2021","MM-DD":"06-09"},"link":"2021/06/08/数字图像处理期末","comments":true,"tags":["数字图像处理 C++"],"categories":["课内学习"],"updated":"2021-06-09T09:49:52.261Z","content":"<blockquote>\n<p>本笔记主要是服务于广东工业大学（GDUT）数字图像处理期末考试，内涵全部考试范围内的程序</p>\n</blockquote>\n<p>[TOC]</p>\n<h3 id=\"01位图处理程序的最小系统\">01位图处理程序的最小系统<a title=\"#01位图处理程序的最小系统\" href=\"#01位图处理程序的最小系统\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                       </span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，一行象素占据的字节个数</span></span><br><span class=\"line\">    \t\t\t\t\t\t\t<span class=\"comment\">//对于RGB图像而言，一个像素三字节</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">    <span class=\"comment\">//值得注意的是unsigned char是一个无符号位的char，可以将其容量看为一个字节（1Byte）或者8bit</span></span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    <span class=\"comment\">//buffer指向一个数组，这个数组的大小可以装下该图像的所有字节！！！！！</span></span><br><span class=\"line\">    \t\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//注意是字节！！！</span></span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;\t<span class=\"comment\">//定义像素坐标变量</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;\t<span class=\"comment\">//定义红绿蓝像素数据变量</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;\t<span class=\"comment\">//定义CDC类的指针变量</span></span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();\t<span class=\"comment\">//获得当前窗口描述设备对象的指针</span></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">             <span class=\"comment\">//WidthBytes/Lie = 每一个像素的字节数</span></span><br><span class=\"line\">             <span class=\"comment\">//i*(WidthBytes/Lie) = 每个像素字节数的起始索引，由于i在循环中退一位了，所以此时不用-1</span></span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">             <span class=\"comment\">//一次循环读取一次RGB数据送入SetPixel方法生成像素点数据</span></span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"02-直方图\">02 直方图<a title=\"#02-直方图\" href=\"#02-直方图\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                  </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，一行象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes]; \t<span class=\"comment\">//buffer指向一个数组，这个数组的大小可以装下该图像的所有字节！！！！！</span></span><br><span class=\"line\">    \t\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//注意是字节！！！</span></span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;\t\\\\定义像素坐标变量</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;\t\\\\定义红绿蓝像素数据变量</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;\t\\\\定义CDC类的指针变量</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();\t\\\\获得当前窗口描述设备对象的指针</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;\t\t\t\t\t\t<span class=\"comment\">//定义整型变量，当前循环到的像素的灰度值会暂时赋值给这个变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针，灰度图像的像素灰度数据将会存储在该指针指向的空间</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];\t<span class=\"comment\">//因为我们知道这个数组存储的数据是灰度值，灰度值是[0~255],只需要一个字节，因此该</span></span><br><span class=\"line\">    \t\t\t\t\t\t\t\t\t <span class=\"comment\">//数组存储的数据量大小为Hang*Lie*1</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];\t<span class=\"comment\">//红[0~255]</span></span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];\t<span class=\"comment\">//绿[0~255]</span></span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];\t<span class=\"comment\">//蓝[0~255]</span></span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;\t\t<span class=\"comment\">//将RGB值相加除以3取平均值</span></span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));\t<span class=\"comment\">//将灰度值作为原来数组的RGB数据传入，因为RGB都是一个值，显示出来的颜色是一个灰色</span></span><br><span class=\"line\">            \t\t\t\t\t\t\t\t\t <span class=\"comment\">//原理参照RGB颜色模型说明</span></span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;\t<span class=\"comment\">// 向buffer这个装灰度图所有数据的数组装入计算好的灰度值</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Zhifangtu[<span class=\"number\">256</span>];\t<span class=\"comment\">//众所周知，直方图描述图像中具有该灰度级的像素的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t\tZhifangtu[k]=<span class=\"number\">0</span>;\t<span class=\"comment\">//先将这个直方图进行初始化，所有的元素赋0，防止数组未赋值的随机数干扰程序</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下灰度图的直方图输出&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttemp=buffer2[j*Lie+i];\t<span class=\"comment\">//存储循环到的像素的灰度值</span></span><br><span class=\"line\">\t\t\tZhifangtu[temp]++;\t<span class=\"comment\">//为相应的灰度级+1</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">//\t以下是简单的图像存储和位图移动</span></span><br><span class=\"line\">\tFILE* fp=<span class=\"built_in\">fopen</span>(<span class=\"string\">&quot;F://abc.txt&quot;</span>,<span class=\"string\">&quot;w&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t\t<span class=\"built_in\">fprintf</span>(fp,<span class=\"string\">&quot;灰阶＝%d 次数=%d\\n&quot;</span>,k,Zhifangtu[k]);</span><br><span class=\"line\">\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpDC-&gt;<span class=\"built_in\">MoveTo</span>(Lie+<span class=\"number\">20</span>+k,Hang);</span><br><span class=\"line\">\t\tpDC-&gt;<span class=\"built_in\">LineTo</span>(Lie+<span class=\"number\">20</span>+k,Hang-Zhifangtu[k]*<span class=\"number\">0.1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"03-点运算\">03 点运算<a title=\"#03-点运算\" href=\"#03-点运算\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                     </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2,*buffer3;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];\t   <span class=\"comment\">//存储灰度图字节数据</span></span><br><span class=\"line\">\tbuffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];\t   <span class=\"comment\">//存储线性点运算处理后的灰度级数据</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//结束以上流程后，我们最终得到了存储灰度图数据的buffer2</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下灰度图的点运算输出&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">//以下为线性点运算</span></span><br><span class=\"line\">    <span class=\"keyword\">float</span> a=<span class=\"number\">1.5</span>,b=<span class=\"number\">0</span>;\t<span class=\"comment\">//解释一下这个点运算的作用，b=0对整体的图像没有任何影响</span></span><br><span class=\"line\">    \t\t\t\t   <span class=\"comment\">//a&gt;1，即整体图像的对比度增加，亮的地方越亮，暗的地方越暗</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> DA,DB;\t\t   <span class=\"comment\">//DA临时存储的是灰度值，DB存储的是计算之后的结果</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tDA=buffer2[j*Lie+i];\t<span class=\"comment\">//将循环到的像素的灰度值存入DA</span></span><br><span class=\"line\">\t\t\tDB=a*DA+b;\t\t\t   <span class=\"comment\">//进行简单的计算工作，对读取到的灰度值进行点运算</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(DB&gt;<span class=\"number\">255</span>) DB=<span class=\"number\">255</span>;\t    <span class=\"comment\">//一般是不可能大于255的，因为这个灰度值是从前面的RGB图像求平均转化而来的，</span></span><br><span class=\"line\">            \t\t\t\t\t   <span class=\"comment\">//不过为了程序的严谨还是设定将超过255的灰度值设定为255</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(DB&lt;<span class=\"number\">0</span>) DB=<span class=\"number\">0</span>;\t\t   <span class=\"comment\">//同上面所述也是为了严谨，将小于0的灰度值转化为</span></span><br><span class=\"line\">\t\t\tbuffer3[j*Lie+i]=DB;    <span class=\"comment\">//存储处理后的灰度级</span></span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\ttemp=buffer3[j*Lie+i];\t<span class=\"comment\">//这一步太太冗余了，没必要，使用DB直接代替temp它不香吗</span></span><br><span class=\"line\">            \t\t\t\t\t   <span class=\"comment\">//上面的判断失误了：</span></span><br><span class=\"line\">            \t\t\t\t\t\t\t<span class=\"comment\">//失误在于没有理解buffer是unsigned char类型</span></span><br><span class=\"line\">            \t\t\t\t\t\t\t<span class=\"comment\">//SetPixel是要求输入的RGB数据为整数型</span></span><br><span class=\"line\">\t\t\tpDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));\t<span class=\"comment\">//将数据加载到位图</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t //以下为非线性点运算----轮廓线</span></span><br><span class=\"line\"><span class=\"comment\">\tint DA,DB;</span></span><br><span class=\"line\"><span class=\"comment\">    for(j=0;j&lt;Hang;j++)</span></span><br><span class=\"line\"><span class=\"comment\">\t&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tfor(i=0;i&lt;Lie;i++)</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tDA=buffer2[j*Lie+i];</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif(DA&lt;128)  DB=0;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif(DA&gt;=128&amp;&amp;DA&lt;=128+5) DB=255;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif(DA&gt;128+5) DB=0;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif(DB&gt;255) DB=255;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tif(DB&lt;0) DB=0;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tbuffer3[j*Lie+i]=DB;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\ttemp=buffer3[j*Lie+i];</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tpDC-&gt;SetPixel(i,j,RGB(temp,temp,temp));</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"04-代数运算--加法（生成叠加图像）\">04 代数运算–加法（生成叠加图像）<a title=\"#04-代数运算--加法（生成叠加图像）\" href=\"#04-代数运算--加法（生成叠加图像）\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;math.h&quot;</span>                                </span></span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap2;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm2;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2,*buffer3;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap2.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap2.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP3);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap2.<span class=\"built_in\">GetBitmap</span> (&amp;bm2);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap2.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer2);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tbuffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR1,tempG1,tempB1;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR2,tempG2,tempB2;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR3,tempG3,tempB3;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">//以上代码只是完成了一个功能</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    \t将图像的RGB数据读出来，按顺序放在两个数组中（buffer和buffer2）</span></span><br><span class=\"line\"><span class=\"comment\">    \t其他的就是转化位图操作而已</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">\t<span class=\"comment\">//以下进行代数运算--加法(生成叠加图像)</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行代数运算--加法(生成叠加图像)&quot;</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">            *\t以下代码只是分别将两个数据数组的对应相同位置的像素读取出来，然后求平均</span></span><br><span class=\"line\"><span class=\"comment\">            *\t最后再将数据按顺序存储到buffer3指定的数组中</span></span><br><span class=\"line\"><span class=\"comment\">            */</span></span><br><span class=\"line\">            </span><br><span class=\"line\">\t\t\ttempR1=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG1=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB1=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\ttempR2=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG2=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB2=buffer2[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\ttempR3=(tempR1+tempR2)/<span class=\"number\">2</span>;</span><br><span class=\"line\">\t\t\ttempG3=(tempG1+tempG2)/<span class=\"number\">2</span>;</span><br><span class=\"line\">\t\t\ttempB3=(tempB1+tempB2)/<span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>]=tempR3;</span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>]=tempG3;</span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>]=tempB3;</span><br><span class=\"line\">\t\t\tpDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR3,tempG3,tempB3));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;\t<span class=\"comment\">//至此，原图的灰度图生成，放在buffer2内存条中   </span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"05-代数运算--减法（梯度幅值）\">05 代数运算–减法（梯度幅值）<a title=\"#05-代数运算--减法（梯度幅值）\" href=\"#05-代数运算--减法（梯度幅值）\"></a></h3>\n<blockquote>\n<p>这个代码的思想需要重点学习下</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t这个程序的写的思想很重要，重点学习</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;math.h&quot;</span>                                </span></span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//以下进行图像的减法运算(求梯度幅度)</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行图像的减法运算(求梯度幅度)&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    \t注意这里用来装灰度图的数组整体的容量大小我们不改变</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">\tBYTE *buffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];    </span><br><span class=\"line\">\tBYTE *buffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];    </span><br><span class=\"line\">\tBYTE *buffer4= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];   </span><br><span class=\"line\">\tBYTE *buffer5= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];   </span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>]=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">\t\t\tpDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(buffer2[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>],buffer2[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>],buffer2[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>]));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;<span class=\"comment\">//至此，原图的灰度图生成，放在buffer2内存条中</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie<span class=\"number\">-1</span>;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tbuffer3[j*Lie+i*<span class=\"number\">1</span>]=buffer2[j*Lie+(i+<span class=\"number\">1</span>)*<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;<span class=\"comment\">//至此，原图灰度图的左移一个像素点的图像生成，放在buffer3内存条中</span></span><br><span class=\"line\">    <span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\">         1.注意这里的Lie循环需要少循环一次！！！！！！！！！！！！</span></span><br><span class=\"line\"><span class=\"comment\">         因此整体的数据减少了一列</span></span><br><span class=\"line\"><span class=\"comment\">         2.在这里根据梯度的定义其实左移右移都是没有关系的</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang<span class=\"number\">-1</span>;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tbuffer4[j*Lie+i*<span class=\"number\">1</span>]=buffer2[(j+<span class=\"number\">1</span>)*Lie+i*<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;<span class=\"comment\">//至此，原图灰度图的上移一个像素点的图像生成，放在buffer4内存条中</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    \t以上的代码是</span></span><br><span class=\"line\"><span class=\"comment\">    \t1.将RGB转化为灰度图放置在buffer2</span></span><br><span class=\"line\"><span class=\"comment\">    \t2.将buffer2中的灰度图左移一列，仍然遵循左+右-</span></span><br><span class=\"line\"><span class=\"comment\">    \t3.将buffer2中的灰度图像上移一个像素点，在数字图像中因为y轴是向下的</span></span><br><span class=\"line\"><span class=\"comment\">    \t长成这个样子，所以需要上移的时候就需要行数+1</span></span><br><span class=\"line\"><span class=\"comment\">    \t（0，0）      x</span></span><br><span class=\"line\"><span class=\"comment\">            ——————————————————————&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            |</span></span><br><span class=\"line\"><span class=\"comment\">            |</span></span><br><span class=\"line\"><span class=\"comment\">            |</span></span><br><span class=\"line\"><span class=\"comment\">           y|</span></span><br><span class=\"line\"><span class=\"comment\">            |</span></span><br><span class=\"line\"><span class=\"comment\">            |</span></span><br><span class=\"line\"><span class=\"comment\">          4.循环的时候需要行数循环减少一次，因此整体的数据量少了一行</span></span><br><span class=\"line\"><span class=\"comment\">          5.在这里根据梯度的定义其实上移下移都是没有关系的</span></span><br><span class=\"line\"><span class=\"comment\">    \t</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"comment\">//------------------------------------------------------------------------------------------------------------------------</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;两个平移图构造完毕&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 在这里上面构造数组buffer3和buffer4的时候使用和buffer2一样的大小的好处就显现出来了，可以循环原来图像的全部数据，</span></span><br><span class=\"line\">    <span class=\"comment\">// 但是存在缺点，因为数组没有赋值随机取样，小图像可能会导致边缘的梯度计算出来较为混乱</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t    BYTE temp1,temp2,temp3,temp4,temp5;</span><br><span class=\"line\">\t\t\ttemp1=buffer2[j*Lie+i*<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttemp2=buffer3[j*Lie+i*<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttemp3=buffer4[j*Lie+i*<span class=\"number\">1</span>];</span><br><span class=\"line\">             <span class=\"comment\">//分别是左右相减，上下相减，分别取绝对值</span></span><br><span class=\"line\">\t\t\ttemp4=<span class=\"built_in\">fabs</span>(temp2-temp1);</span><br><span class=\"line\">\t\t\ttemp5=<span class=\"built_in\">fabs</span>(temp3-temp1);</span><br><span class=\"line\">             <span class=\"comment\">//找到两组梯度中的最大者者</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(temp5&gt;temp4)</span><br><span class=\"line\">\t\t\t\tbuffer5[j*Lie+i*<span class=\"number\">1</span>]=temp5;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tbuffer5[j*Lie+i*<span class=\"number\">1</span>]=temp4;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> temp6;</span><br><span class=\"line\">             <span class=\"comment\">// 这里*10没有什么特殊意义，只是为了使梯度的值更大，展示出来明显点</span></span><br><span class=\"line\">\t\t\ttemp6=buffer5[j*Lie+i*<span class=\"number\">1</span>]*<span class=\"number\">10</span>;</span><br><span class=\"line\">             <span class=\"comment\">// 将buffer5依据*10后的值进行保存</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(temp6&gt;<span class=\"number\">255</span>)</span><br><span class=\"line\">\t\t\t\tbuffer5[j*Lie+i*<span class=\"number\">1</span>]=<span class=\"number\">255</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tbuffer5[j*Lie+i*<span class=\"number\">1</span>]=temp6;</span><br><span class=\"line\">\t\t\tpDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(buffer5[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>],buffer5[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>],buffer5[j*Lie+i*<span class=\"number\">1</span>+<span class=\"number\">0</span>]));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;<span class=\"comment\">//至此，原图灰度图的梯度幅度图生成，放在buffer5内存条中</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"06-几何运算\">06 几何运算<a title=\"#06-几何运算\" href=\"#06-几何运算\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                     </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;math.h&quot;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2,*buffer3;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">\tbuffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"> <span class=\"comment\">//-------------------------------------------------------------------------------------------------------------------</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下灰度图的几何运算输出&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">Invalidate</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">UpdateWindow</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">double</span> a=<span class=\"number\">200</span>,b=<span class=\"number\">100</span>,Beta=<span class=\"number\">3.14</span>/<span class=\"number\">6</span>;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    \t下面这个矩阵[[T11,T12,T13],</span></span><br><span class=\"line\"><span class=\"comment\">    \t\t\t   [T21,T22,T23],</span></span><br><span class=\"line\"><span class=\"comment\">    \t\t\t   [T31,T32,T33]]</span></span><br><span class=\"line\"><span class=\"comment\">    \t它的运算过程比较奇怪，各位看了有什么想法请发在评论区</span></span><br><span class=\"line\"><span class=\"comment\">    \t下面使用*表示矩阵点乘</span></span><br><span class=\"line\"><span class=\"comment\">    \t[[1,0,a],\t\t[[cos(Beta),sin(Bate) ,0],\t\t[[1,0,-a],</span></span><br><span class=\"line\"><span class=\"comment\">    \t [0,1,b],\t* \t [-sin(Bate),cos(Beta),0],  *     [0,1,-b],</span></span><br><span class=\"line\"><span class=\"comment\">    \t [0,0,1]]\t\t [    0     ,   0     ,0]]\t\t [0,0, 1]]</span></span><br><span class=\"line\"><span class=\"comment\">    \t 可以得到下面的这个矩阵</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T11=<span class=\"built_in\">cos</span>(Beta),T12=<span class=\"built_in\">sin</span>(Beta),T13=-a*<span class=\"built_in\">cos</span>(Beta)-b*<span class=\"built_in\">sin</span>(Beta)+a;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T21=-<span class=\"built_in\">sin</span>(Beta),T22=<span class=\"built_in\">cos</span>(Beta),T23=a*<span class=\"built_in\">sin</span>(Beta)-b*<span class=\"built_in\">cos</span>(Beta)+b;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T31=<span class=\"number\">0</span>,T32=<span class=\"number\">0</span>,T33=<span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    double T11=1.25,T12=0,T13=0;</span></span><br><span class=\"line\"><span class=\"comment\">\tdouble T21=0,T22=1.25,T23=0;</span></span><br><span class=\"line\"><span class=\"comment\">\tdouble T31=0,T32=0,T33=1;</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> x0=<span class=\"number\">30</span>,y0=<span class=\"number\">40</span>;\t<span class=\"comment\">//输入图像的行列坐标</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> x1,y1;\t\t<span class=\"comment\">//输出图像的行列坐标</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/*\t</span></span><br><span class=\"line\"><span class=\"comment\">\tx1=T11*x0+T12*y0+T13*1;</span></span><br><span class=\"line\"><span class=\"comment\">\ty1=T21*x0+T22*y0+T23*1;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tCString str;</span></span><br><span class=\"line\"><span class=\"comment\">\tstr.Format(&quot;x1=%d,y1=%d&quot;,x1,y1);</span></span><br><span class=\"line\"><span class=\"comment\">\tpDC-&gt;TextOut(0,0,str);</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(y0=<span class=\"number\">0</span>;y0&lt;Hang;y0++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x0=<span class=\"number\">0</span>;x0&lt;Lie;x0++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">            <span class=\"comment\">// 根据上面的公式，其他的只是简单运算</span></span><br><span class=\"line\">            <span class=\"comment\">// 记住几何运算的灰度值不变，只是像素的位置变了</span></span><br><span class=\"line\">\t\t\tx1=T11*x0+T12*y0+T13*<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\ty1=T21*x0+T22*y0+T23*<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\ttemp=buffer2[y0*Lie+x0];\t<span class=\"comment\">//获取原来图像原像素点的灰度值</span></span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(x1,y1,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"07-几何运算加插值运算\">07 几何运算加插值运算<a title=\"#07-几何运算加插值运算\" href=\"#07-几何运算加插值运算\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;math.h&quot;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2,*buffer3;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];\t   </span><br><span class=\"line\">\tbuffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下灰度图的几何运算输出&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">Invalidate</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">UpdateWindow</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">double</span> a=<span class=\"number\">200</span>,b=<span class=\"number\">100</span>,Beta=<span class=\"number\">3.14</span>/<span class=\"number\">6</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T11=<span class=\"built_in\">cos</span>(Beta),T12=<span class=\"built_in\">sin</span>(Beta),T13=-a*<span class=\"built_in\">cos</span>(Beta)-b*<span class=\"built_in\">sin</span>(Beta)+a;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T21=-<span class=\"built_in\">sin</span>(Beta),T22=<span class=\"built_in\">cos</span>(Beta),T23=a*<span class=\"built_in\">sin</span>(Beta)-b*<span class=\"built_in\">cos</span>(Beta)+b;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> T31=<span class=\"number\">0</span>,T32=<span class=\"number\">0</span>,T33=<span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\tdouble T11=1.25,T12=0,T13=0;</span></span><br><span class=\"line\"><span class=\"comment\">\tdouble T21=0,T22=1.25,T23=0;</span></span><br><span class=\"line\"><span class=\"comment\">\tdouble T31=0,T32=0,T33=1;</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> x0=<span class=\"number\">30</span>,y0=<span class=\"number\">40</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> x1,y1;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/*\t</span></span><br><span class=\"line\"><span class=\"comment\">\tx1=T11*x0+T12*y0+T13*1;</span></span><br><span class=\"line\"><span class=\"comment\">\ty1=T21*x0+T22*y0+T23*1;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tCString str;</span></span><br><span class=\"line\"><span class=\"comment\">\tstr.Format(&quot;x1=%d,y1=%d&quot;,x1,y1);</span></span><br><span class=\"line\"><span class=\"comment\">\tpDC-&gt;TextOut(0,0,str);</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;Hang*Lie;k++)  <span class=\"comment\">//旋转后的图寄存在buffer3内存中，并且先清零</span></span><br><span class=\"line\">\t\tbuffer3[k]=<span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(y0=<span class=\"number\">0</span>;y0&lt;Hang;y0++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x0=<span class=\"number\">0</span>;x0&lt;Lie;x0++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">             <span class=\"comment\">//因为x1，y1是整数型，所以也可以看作变换后的像素点</span></span><br><span class=\"line\">             <span class=\"comment\">//在这里自动移动到了位图中距离它最近的像素的位置</span></span><br><span class=\"line\">\t\t\tx1=T11*x0+T12*y0+T13*<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\ty1=T21*x0+T22*y0+T23*<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\ttemp=buffer2[y0*Lie+x0];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(x1,y1,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">             <span class=\"comment\">// 由于由零开始循环，因此超过(Lie-1)或者(Hang-1)就是已经超过图像大小范围</span></span><br><span class=\"line\">             <span class=\"comment\">// 因此对于超过范围的部分就要将他们归到数据范围内</span></span><br><span class=\"line\">             <span class=\"comment\">// 本质原因平移旋转再平移会使得图像像素可能会超出原来图像的范围 </span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(x1&gt;Lie<span class=\"number\">-1</span>) x1=Lie<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(x1&lt;<span class=\"number\">0</span>) x1=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(y1&gt;Hang<span class=\"number\">-1</span>) y1=Hang<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(y1&lt;<span class=\"number\">0</span>) y1=<span class=\"number\">0</span>;</span><br><span class=\"line\">             <span class=\"comment\">// 将处理后的数据装入buffer3，方便后续进行双线性插值 </span></span><br><span class=\"line\">             <span class=\"comment\">// 这里不会产生bug，因为y1和x1在定义的时候就已经要求必须是整数了</span></span><br><span class=\"line\">\t\t\tbuffer3[y1*Lie+x1]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行插值运算&quot;</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">double</span> Tni11=<span class=\"number\">0.8660</span>,Tni12=<span class=\"number\">-0.5000</span>,Tni13=<span class=\"number\">76.7949</span>;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> Tni21=<span class=\"number\">0.5000</span>,Tni22=<span class=\"number\">0.8660</span>,Tni23=<span class=\"number\">-86.6025</span>;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> Tni31=<span class=\"number\">0</span>,Tni32=<span class=\"number\">0</span>,Tni33=<span class=\"number\">1.0000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">double</span> x0pi,y0pi;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(y1=<span class=\"number\">0</span>;y1&lt;Hang;y1++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x1=<span class=\"number\">0</span>;x1&lt;Lie;x1++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">            <span class=\"comment\">//在这里没有被赋值的x1和y1对应的像素，说明没有被原图像对应上，因此需要将该点映射到原图像，然后通过最近邻算法求出其值</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(buffer3[y1*Lie+x1]==<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t&#123;\t</span><br><span class=\"line\">                  <span class=\"comment\">//通过逆函数计算原来的x0和y0的值</span></span><br><span class=\"line\">\t\t\t\tx0pi=Tni11*x1+Tni12*y1+Tni13;</span><br><span class=\"line\">\t\t\t\ty0pi=Tni21*x1+Tni22*y1+Tni23;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">                  <span class=\"comment\">//以下是最近邻插值算法（四舍五入）</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(x0pi-(<span class=\"keyword\">int</span>)x0pi&gt;<span class=\"number\">0.5</span>) x0pi=(<span class=\"keyword\">int</span>)x0pi+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span> x0pi=(<span class=\"keyword\">int</span>)x0pi;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(y0pi-(<span class=\"keyword\">int</span>)y0pi&gt;<span class=\"number\">0.5</span>) y0pi=(<span class=\"keyword\">int</span>)y0pi+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span> y0pi=(<span class=\"keyword\">int</span>)y0pi;\t<span class=\"comment\">//完成以上语句后，此时的x0和y0对应的就是x1和y1的返回原数组时对应的最近的像素点</span></span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">                 <span class=\"comment\">//对于映射后在画面外的像素进行放弃</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(x0pi&gt;Lie<span class=\"number\">-1</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(x0pi&lt;<span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(y0pi&gt;Hang<span class=\"number\">-1</span>) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(y0pi&lt;<span class=\"number\">0</span>) <span class=\"keyword\">continue</span>;\t</span><br><span class=\"line\">                 <span class=\"comment\">//然后进行赋值</span></span><br><span class=\"line\">\t\t\t\tbuffer3[y1*Lie+x1]=buffer2[(<span class=\"keyword\">int</span>)y0pi*Lie+(<span class=\"keyword\">int</span>)x0pi];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//最后将插值的效果显示</span></span><br><span class=\"line\">    <span class=\"built_in\">Invalidate</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">UpdateWindow</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(y1=<span class=\"number\">0</span>;y1&lt;Hang;y1++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x1=<span class=\"number\">0</span>;x1&lt;Lie;x1++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(x1,y1,<span class=\"built_in\">RGB</span>(buffer3[y1*Lie+x1],buffer3[y1*Lie+x1],buffer3[y1*Lie+x1]));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"08-直方图均衡化\">08 直方图均衡化<a title=\"#08-直方图均衡化\" href=\"#08-直方图均衡化\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Zhifangtu[<span class=\"number\">256</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t\tZhifangtu[k]=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下灰度图的直方图输出&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttemp=buffer2[j*Lie+i];</span><br><span class=\"line\">\t\t\tZhifangtu[temp]++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tFILE* fp=<span class=\"built_in\">fopen</span>(<span class=\"string\">&quot;F://abc.txt&quot;</span>,<span class=\"string\">&quot;w&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t\t<span class=\"built_in\">fprintf</span>(fp,<span class=\"string\">&quot;灰阶＝%d 次数=%d\\n&quot;</span>,k,Zhifangtu[k]);</span><br><span class=\"line\">\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpDC-&gt;<span class=\"built_in\">MoveTo</span>(Lie+<span class=\"number\">20</span>+k,Hang);</span><br><span class=\"line\">\t\tpDC-&gt;<span class=\"built_in\">LineTo</span>(Lie+<span class=\"number\">20</span>+k,Hang-Zhifangtu[k]*<span class=\"number\">0.1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"comment\">//--------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行直方图均衡化&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> Prk[<span class=\"number\">256</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t\tPrk[k]=(<span class=\"keyword\">double</span>)Zhifangtu[k]/(Hang*Lie);   <span class=\"comment\">//计算输入图像的归一化直方图函数</span></span><br><span class=\"line\">\t<span class=\"keyword\">double</span> Sk[<span class=\"number\">256</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tSk[k]=<span class=\"number\">0.0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k2=<span class=\"number\">0</span>;k2&lt;=k;k2++)</span><br><span class=\"line\">\t\t   Sk[k]+=Prk[k2];       <span class=\"comment\">//完成直方图均衡化公式中的累加运算</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> S[<span class=\"number\">256</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tS[k]=Sk[k]*<span class=\"number\">255</span>;   <span class=\"comment\">//S[k]就是直方图均衡化的映射函数（即点运算的灰度变换函数）</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(S[k]-(<span class=\"keyword\">int</span>)S[k]&gt;<span class=\"number\">0.5</span>) S[k]=(<span class=\"keyword\">int</span>)S[k]+<span class=\"number\">1</span>;  <span class=\"comment\">//完成映射函数的四舍五入取整</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> S[k]=(<span class=\"keyword\">int</span>)S[k];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">//不算冗余，double数组换int数组可以大规模的减少内存消耗</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> T[<span class=\"number\">256</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> r=<span class=\"number\">0</span>;r&lt;<span class=\"number\">256</span>;r++)</span><br><span class=\"line\">\t\tT[r]=(<span class=\"keyword\">int</span>)S[r];    <span class=\"comment\">//T[r]就是均衡化映射后的新灰度值</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tr=buffer2[j*Lie+i];   <span class=\"comment\">//将输入图像j行i列的像素值赋予r</span></span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(T[r],T[r],T[r]));  <span class=\"comment\">//T[r]是映射后的新灰度值，即输出图像在j行i列</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"09-空域滤波（模板卷积运算）\">09 空域滤波（模板卷积运算）<a title=\"#09-空域滤波（模板卷积运算）\" href=\"#09-空域滤波（模板卷积运算）\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2,*buffer3;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">\tbuffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行空域滤波(模板卷积运算)&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">double</span> h1=<span class=\"number\">0.0</span>,h2=<span class=\"number\">-4.0</span>,h3=<span class=\"number\">0.0</span>,h4=<span class=\"number\">-4.0</span>,h5=<span class=\"number\">16.0</span>,h6=<span class=\"number\">-4.0</span>,h7=<span class=\"number\">0.0</span>,h8=<span class=\"number\">-4.0</span>,h9=<span class=\"number\">0.0</span>;<span class=\"comment\">//拉普拉斯算子</span></span><br><span class=\"line\">    <span class=\"comment\">//double h1=-4.0,h2=-4.0,h3=8.0,h4=-4.0,h5=8.0,h6=-4.0,h7=8.0,h8=-4.0,h9=-4.0;//定向滤波</span></span><br><span class=\"line\">    <span class=\"comment\">//double h11=0,h12=0,h13=0,h14=0,h17=0,h15=4,h16=4,h18=-4,h19=-4;//罗伯特算子</span></span><br><span class=\"line\">    <span class=\"comment\">//double h21=0,h22=0,h23=0,h24=0,h27=0,h25=-4,h26=4,h28=-4,h29=4;</span></span><br><span class=\"line\">    <span class=\"comment\">//double h31=0,h32=0,h33=0,h34=0,h37=0,h35=4,h36=-4,h38=4,h39=-4;</span></span><br><span class=\"line\">    <span class=\"comment\">//double h41=0,h42=0,h43=0,h44=0,h47=0,h45=-4,h46=-4,h48=4,h49=4;</span></span><br><span class=\"line\">    <span class=\"comment\">//double h1=1.0/9,h2=1.0/9,h3=1.0/9,h4=1.0/9,h5=1.0/9,h6=1.0/9,h7=1.0/9,h8=1.0/9,h9=1.0/9;//邻域平均算子</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> f1,f2,f3,f4,f5,f6,f7,f8,f9;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> temp1,temp2,temp3,temp4;</span><br><span class=\"line\">\t<span class=\"keyword\">double</span> temp5;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Yuzhi;</span><br><span class=\"line\">    <span class=\"comment\">//只需注意Hang和Lie都是-1即可</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(j=<span class=\"number\">1</span>;j&lt;Hang<span class=\"number\">-1</span>;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">1</span>;i&lt;Lie<span class=\"number\">-1</span>;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tf1=buffer2[(j<span class=\"number\">-1</span>)*Lie+(i<span class=\"number\">-1</span>)];</span><br><span class=\"line\">\t\t\tf2=buffer2[(j<span class=\"number\">-1</span>)*Lie+(i+<span class=\"number\">0</span>)];</span><br><span class=\"line\">\t\t\tf3=buffer2[(j<span class=\"number\">-1</span>)*Lie+(i+<span class=\"number\">1</span>)];</span><br><span class=\"line\">\t\t\tf4=buffer2[(j+<span class=\"number\">0</span>)*Lie+(i<span class=\"number\">-1</span>)];</span><br><span class=\"line\">\t\t\tf5=buffer2[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">0</span>)];</span><br><span class=\"line\">\t\t\tf6=buffer2[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">1</span>)];</span><br><span class=\"line\">\t\t\tf7=buffer2[(j+<span class=\"number\">1</span>)*Lie+(i<span class=\"number\">-1</span>)];</span><br><span class=\"line\">\t\t\tf8=buffer2[(j+<span class=\"number\">1</span>)*Lie+(i+<span class=\"number\">0</span>)];</span><br><span class=\"line\">\t\t\tf9=buffer2[(j+<span class=\"number\">1</span>)*Lie+(i+<span class=\"number\">1</span>)];</span><br><span class=\"line\">            temp5=h1*f1+h2*f2+h3*f3+h4*f4+h5*f5+h6*f6+h7*f7+h8*f8+h9*f9;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//temp1=h11*f1+h12*f2+h13*f3+h14*f4+h15*f5+h16*f6+h17*f7+h18*f8+h19*f9;</span></span><br><span class=\"line\">            <span class=\"comment\">//temp2=h21*f1+h22*f2+h23*f3+h24*f4+h25*f5+h26*f6+h27*f7+h28*f8+h29*f9;</span></span><br><span class=\"line\">            <span class=\"comment\">//temp3=h31*f1+h32*f2+h33*f3+h34*f4+h35*f5+h36*f6+h37*f7+h38*f8+h39*f9;</span></span><br><span class=\"line\">            <span class=\"comment\">//temp4=h41*f1+h42*f2+h43*f3+h44*f4+h45*f5+h46*f6+h47*f7+h48*f8+h49*f9;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//if(temp1&gt;temp2&amp;&amp;temp1&gt;temp3&amp;&amp;temp1&gt;temp4) temp5=temp1;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//if(temp2&gt;temp1&amp;&amp;temp2&gt;temp3&amp;&amp;temp2&gt;temp4) temp5=temp2;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//if(temp3&gt;temp1&amp;&amp;temp3&gt;temp2&amp;&amp;temp3&gt;temp4) temp5=temp3;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//if(temp4&gt;temp1&amp;&amp;temp4&gt;temp2&amp;&amp;temp4&gt;temp3) temp5=temp4;</span></span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">             <span class=\"comment\">//对得到的新值进行简单的处理然后赋值</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(temp5&gt;<span class=\"number\">255</span>) temp5=<span class=\"number\">255</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(temp5&lt;<span class=\"number\">0</span>) temp5=<span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tbuffer3[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">0</span>)]=temp5;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(buffer3[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">0</span>)],buffer3[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">0</span>)],buffer3[(j+<span class=\"number\">0</span>)*Lie+(i+<span class=\"number\">0</span>)]));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"10-伪色彩图像增强\">10 伪色彩图像增强<a title=\"#10-伪色彩图像增强\" href=\"#10-伪色彩图像增强\"></a></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxwin.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxext.h&gt;</span> </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdisp.h&gt;</span>   </span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;afxdtctl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;resource.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*文档类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CDoc</span>:</span> <span class=\"keyword\">public</span> CDocument</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CDoc)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CDoc, CDocument)</span><br><span class=\"line\"><span class=\"comment\">/*主帧窗口类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMainFrame</span> :</span> <span class=\"keyword\">public</span> CFrameWnd</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMainFrame)</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMainFrame, CFrameWnd)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*视图类*/</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CMyView</span> :</span> <span class=\"keyword\">public</span> CView</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"comment\">//区域一：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_MESSAGE_MAP</span>()</span><br><span class=\"line\">\t<span class=\"built_in\">DECLARE_DYNCREATE</span>(CMyView)</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">CMyView</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//区域二：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//↑↑↑↑↑↑↑↑↑↑↑自由写代码区域截止线，其它区域请勿作任何修改↑↑↑↑↑</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">virtual</span> ~<span class=\"built_in\">CMyView</span>()&#123;&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">void</span> <span class=\"title\">OnDraw</span><span class=\"params\">(CDC* pDC)</span></span>&#123;&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">protected</span>:                                                          </span><br><span class=\"line\">\t<span class=\"function\">afx_msg <span class=\"keyword\">void</span> <span class=\"title\">On01</span><span class=\"params\">()</span></span>;                                            </span><br><span class=\"line\">&#125;;                                                                  </span><br><span class=\"line\"><span class=\"built_in\">IMPLEMENT_DYNCREATE</span>(CMyView, CView)                       </span><br><span class=\"line\"><span class=\"built_in\">BEGIN_MESSAGE_MAP</span>(CMyView, CView)                                                    </span><br><span class=\"line\">\t<span class=\"built_in\">ON_COMMAND</span>(ID01, On01)                                           </span><br><span class=\"line\"><span class=\"built_in\">END_MESSAGE_MAP</span>()                                                    </span><br><span class=\"line\">                                                                    </span><br><span class=\"line\"><span class=\"comment\">/*应用程序类*/</span>                                                      </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CApp</span> :</span> <span class=\"keyword\">public</span> CWinApp&#123;\t<span class=\"function\"><span class=\"keyword\">virtual</span> BOOL <span class=\"title\">InitInstance</span><span class=\"params\">()</span></span>; &#125;;</span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">CApp::InitInstance</span> <span class=\"params\">()</span>                             </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;\t\tCSingleDocTemplate* pDocTemplate= <span class=\"keyword\">new</span> <span class=\"built_in\">CSingleDocTemplate</span>(IDR_MENU1,<span class=\"built_in\">RUNTIME_CLASS</span>(CDoc),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">RUNTIME_CLASS</span>(CMainFrame),<span class=\"built_in\">RUNTIME_CLASS</span>(CMyView));</span><br><span class=\"line\">\t\t<span class=\"built_in\">AddDocTemplate</span>(pDocTemplate);CCommandLineInfo cmdInfo;<span class=\"built_in\">ParseCommandLine</span>(cmdInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"built_in\">ProcessShellCommand</span>(cmdInfo))\t<span class=\"keyword\">return</span> FALSE;            </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">ShowWindow</span>(SW_SHOW);m_pMainWnd-&gt;<span class=\"built_in\">UpdateWindow</span>();  </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowPos</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">800</span>,<span class=\"number\">600</span>,<span class=\"number\">0</span>);                </span><br><span class=\"line\">\t\tm_pMainWnd-&gt;<span class=\"built_in\">SetWindowText</span>(<span class=\"string\">&quot;版本1.01.&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> TRUE;                                                 </span><br><span class=\"line\">&#125;                                                                    </span><br><span class=\"line\">CApp theApp;             </span><br><span class=\"line\">                                </span><br><span class=\"line\"><span class=\"comment\">//区域三：↓↓↓↓↓↓↓以下区域可自由写代码，其它区域请勿作任何修改↓↓↓↓↓</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CMyView::On01</span><span class=\"params\">()</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tCBitmap hbitmap;         <span class=\"comment\">//利用&quot;位图类&quot;声明一个标识符为&quot;hbitmap&quot;的变量</span></span><br><span class=\"line\">\tBITMAP bm;               <span class=\"comment\">//利用&quot;位图文件头结构体&quot;声明一个标识符为&quot;bm&quot;的变量</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> Hang,Lie,WidthBytes;       <span class=\"comment\">//声明行总数目，列总数目，单个象素占据的字节个数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">DeleteObject</span>();                                  <span class=\"comment\">//位图类的清空位图函数</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">LoadBitmap</span> (IDB_BITMAP2);                        <span class=\"comment\">//加载位图文件</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmap</span> (&amp;bm);     <span class=\"comment\">//将所加载的位图文件的头文件信息装载到标识符为&quot;bm&quot;的变量中</span></span><br><span class=\"line\">\tHang=bm.bmHeight,Lie=bm.bmWidth,WidthBytes=bm.bmWidthBytes;</span><br><span class=\"line\">\tbuffer= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">\t<span class=\"comment\">//新开辟一段由上述三个变量决定个数的8位整形数组然后被buffer指针所指向</span></span><br><span class=\"line\">\thbitmap.<span class=\"built_in\">GetBitmapBits</span> (Hang*WidthBytes, buffer);   <span class=\"comment\">//录入buffer数组的位图数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//buffer[j*WidthBytes+i*4+k];</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i,j;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> tempR,tempG,tempB;</span><br><span class=\"line\"></span><br><span class=\"line\">    CDC *pDC;</span><br><span class=\"line\">\tpDC=<span class=\"built_in\">GetDC</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下将RGB图转灰度图&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *buffer2;            <span class=\"comment\">//声明了一个8位整型数&quot;buffer&quot;指针</span></span><br><span class=\"line\">\tbuffer2= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*Lie];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ttempR=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">\t\t\ttemp=(tempR+tempG+tempB)/<span class=\"number\">3</span>;</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(temp,temp,temp));</span><br><span class=\"line\">\t\t\tbuffer2[j*Lie+i]=temp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MessageBox</span>(<span class=\"string\">&quot;以下进行灰度图的伪彩色图像增强&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">//重点记住这张彩色索引表的处理方式</span></span><br><span class=\"line\">\t<span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> TR[<span class=\"number\">256</span>],TG[<span class=\"number\">256</span>],TB[<span class=\"number\">256</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;<span class=\"number\">256</span>;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tTR[k]=<span class=\"number\">2</span>*k<span class=\"number\">-3</span>;</span><br><span class=\"line\">\t\tTG[k]=<span class=\"number\">1.5</span>*k<span class=\"number\">-8</span>;</span><br><span class=\"line\">\t\tTB[k]=<span class=\"number\">2.8</span>*k<span class=\"number\">-15</span>;</span><br><span class=\"line\">\t&#125;<span class=\"comment\">//以上索引表建立完毕</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>* buffer3= <span class=\"keyword\">new</span> <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span>[Hang*WidthBytes];    </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;Hang;j++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;Lie;i++)</span><br><span class=\"line\">\t\t&#123;\t</span><br><span class=\"line\">             <span class=\"comment\">//获得像素的灰度然后将其代入索引表得到相对应的新的灰度值</span></span><br><span class=\"line\">\t\t\tk=buffer2[j*Lie+i];</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>]=TR[k];</span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>]=TG[k];</span><br><span class=\"line\">\t\t\tbuffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>]=TB[k];</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">            <span class=\"comment\">//由于SetPixel要求输入整数值，因此在这里进行换算不算冗余</span></span><br><span class=\"line\">\t\t\ttempR=buffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">2</span>];</span><br><span class=\"line\">\t\t\ttempG=buffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\ttempB=buffer3[j*WidthBytes+i*WidthBytes/Lie+<span class=\"number\">0</span>];</span><br><span class=\"line\">    \t    pDC-&gt;<span class=\"built_in\">SetPixel</span>(i,j,<span class=\"built_in\">RGB</span>(tempR,tempG,tempB));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","next":{"title":"MySQL笔记","link":"2021/06/08/MySQL笔记"},"plink":"https://jnbuck.top/2021/06/08/数字图像处理期末/","toc":[{"id":"01位图处理程序的最小系统","title":"01位图处理程序的最小系统","index":"1"},{"id":"02-直方图","title":"02 直方图","index":"2"},{"id":"03-点运算","title":"03 点运算","index":"3"},{"id":"04-代数运算--加法（生成叠加图像）","title":"04 代数运算–加法（生成叠加图像）","index":"4"},{"id":"05-代数运算--减法（梯度幅值）","title":"05 代数运算–减法（梯度幅值）","index":"5"},{"id":"06-几何运算","title":"06 几何运算","index":"6"},{"id":"07-几何运算加插值运算","title":"07 几何运算加插值运算","index":"7"},{"id":"08-直方图均衡化","title":"08 直方图均衡化","index":"8"},{"id":"09-空域滤波（模板卷积运算）","title":"09 空域滤波（模板卷积运算）","index":"9"},{"id":"10-伪色彩图像增强","title":"10 伪色彩图像增强","index":"10"}],"copyright":{"author":"JNbuck","link":"<a href=\"https://jnbuck.top/2021/06/08/数字图像处理期末/\" title=\"数字图像处理期末\">https://jnbuck.top/2021/06/08/数字图像处理期末/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"12049 words in 80 min"}